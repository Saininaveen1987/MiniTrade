âš™ï¸ CLASS MAP (Detailed)
ğŸ§‘â€ğŸ’¼ 1ï¸âƒ£ User

â†’ Represents a trading account in the system.

ğŸ”¹ Relationship

â€œHas aâ€ â†’ Portfolio

â€œHas manyâ€ â†’ Order objects (order history)

â€œUsesâ€ â†’ Broker to place orders

ğŸ”¹ State (Attributes)
| Attribute       | Type        | Description                   |
| --------------- | ----------- | ----------------------------- |
| `username`      | str         | Unique identifier of the user |
| `balance`       | float       | Available trading balance     |
| `portfolio`     | Portfolio   | Userâ€™s holdings and P&L data  |
| `order_history` | list[Order] | All past orders               |

ğŸ”¹ Behaviour (Methods)
| Method                   | Purpose                                     |
| ------------------------ | ------------------------------------------- |
| `add_order(order)`       | Append executed or pending order to history |
| `show_portfolio(market)` | Display portfolio summary with live P&L     |
| `__str__()`              | String representation for debug/logging     |


ğŸ’¼ 2ï¸âƒ£ Portfolio

â†’ Represents a collection of stock holdings and associated valuation.

ğŸ”¹ Relationship

â€œBelongs toâ€ â†’ User

â€œUsesâ€ â†’ Market (for current prices)

ğŸ”¹ State

| Attribute  | Type | Description                                  |
| ---------- | ---- | -------------------------------------------- |
| `holdings` | dict | `{symbol: {"qty": int, "avg_price": float}}` |

ğŸ”¹ Behaviour

| Method                        | Purpose                                      |
| ----------------------------- | -------------------------------------------- |
| `add_buy(symbol, qty, price)` | Update or add new holding with averaged cost |
| `add_sell(symbol, qty)`       | Decrease or remove holding                   |
| `compute_pnl(market)`         | Calculate P&L per symbol and total P&L       |
| `summary(market)`             | Pretty-print portfolio state and live P&L    |



ğŸ¦ 3ï¸âƒ£ Broker

â†’ Middle layer connecting users and the market. Handles validation and routing.

ğŸ”¹ Relationship

â€œHas aâ€ â†’ TradeEngine

â€œHas aâ€ â†’ Market

â€œManages manyâ€ â†’ Order objects

ğŸ”¹ State
| Attribute      | Type        | Description                     |
| -------------- | ----------- | ------------------------------- |
| `market`       | Market      | Reference to the running market |
| `trade_engine` | TradeEngine | Executes validated orders       |
| `order_book`   | list[Order] | List of all processed orders    |

ğŸ”¹ Behaviour

| Method                                       | Purpose                                         |
| -------------------------------------------- | ----------------------------------------------- |
| `place_order(user, symbol, qty, order_type)` | Accept user order, validate, and execute        |
| `_validate_order(user, order)`               | Check user balance or holdings before execution |


âš™ï¸ 4ï¸âƒ£ TradeEngine

â†’ Core execution unit that changes userâ€™s balance and portfolio.

ğŸ”¹ Relationship

â€œBelongs toâ€ â†’ Broker

â€œUsesâ€ â†’ Market (to fetch live prices)

â€œUpdatesâ€ â†’ User and Portfolio

ğŸ”¹ State
| Attribute | Type   | Description                         |
| --------- | ------ | ----------------------------------- |
| `market`  | Market | Market reference for current prices |

ğŸ”¹ Behaviour

| Method                                            | Purpose                                     |
| ------------------------------------------------- | ------------------------------------------- |
| `execute_order(order)`                            | Execute order (buy/sell) using market price |
| `_update_portfolio_buy(user, symbol, qty, price)` | Adjust holding and average price            |
| `_update_portfolio_sell(user, symbol, qty)`       | Reduce holdings and credit proceeds         |




ğŸ’¹ 5ï¸âƒ£ Market

â†’ Simulates live market behaviour.

ğŸ”¹ Relationship

â€œHas manyâ€ â†’ Stock objects

â€œUsed byâ€ â†’ Broker, TradeEngine, Portfolio

ğŸ”¹ State
| Attribute | Type             | Description             |
| --------- | ---------------- | ----------------------- |
| `stocks`  | dict[str, Stock] | Current market snapshot |


ğŸ”¹ Behaviour

| Method              | Purpose                                  |
| ------------------- | ---------------------------------------- |
| `start_market()`    | Start background thread to update prices |
| `get_price(symbol)` | Get current market price of symbol       |
| `list_stocks()`     | Return all stock summaries               |


ğŸ“ˆ 6ï¸âƒ£ Stock

â†’ Represents an individual stock instrument.

ğŸ”¹ Relationship

â€œBelongs toâ€ â†’ Market

ğŸ”¹ State

| Attribute | Type  | Description              |
| --------- | ----- | ------------------------ |
| `symbol`  | str   | Stock ticker (e.g., TCS) |
| `name`    | str   | Full name                |
| `price`   | float | Current market price     |

ğŸ”¹ Behaviour

| Method           | Purpose                                      |
| ---------------- | -------------------------------------------- |
| `update_price()` | Randomly change price to simulate volatility |
| `__str__()`      | Readable representation of stock state       |

ğŸ§¾ 7ï¸âƒ£ Order

â†’ Encapsulates a single trade instruction.

ğŸ”¹ Relationship

â€œBelongs toâ€ â†’ User

â€œProcessed byâ€ â†’ Broker & TradeEngine

ğŸ”¹ State

| Attribute    | Type     | Description                       |
| ------------ | -------- | --------------------------------- |
| `id`         | str      | Unique order ID                   |
| `user`       | User     | Order owner                       |
| `symbol`     | str      | Target stock                      |
| `qty`        | int      | Quantity                          |
| `order_type` | str      | BUY / SELL                        |
| `price`      | float    | Price at execution (market price) |
| `status`     | str      | PENDING / FILLED / REJECTED       |
| `timestamp`  | datetime | Order creation time               |

ğŸ”¹ Behaviour

| Method      | Purpose                              |
| ----------- | ------------------------------------ |
| `__str__()` | Compact readable summary for logs/UI |





ğŸ’¾ 8ï¸âƒ£ DataStore

â†’ Responsible for saving/loading system data persistently.

ğŸ”¹ Relationship

â€œUsed byâ€ â†’ App layer or Broker

â€œStoresâ€ â†’ User, Orders, Portfolio data

ğŸ”¹ State

| Attribute | Type | Description                       |
| --------- | ---- | --------------------------------- |
| `file`    | Path | Path to JSON file for persistence |


ğŸ”¹ Behaviour

| Method                | Purpose                       |
| --------------------- | ----------------------------- |
| `save_user(user)`     | Save user state to JSON file  |
| `load_user(username)` | Retrieve user state from file |



ğŸ§© OOP RELATIONSHIP SUMMARY

| Relationship                                        | Description |
| --------------------------------------------------- | ----------- |
| `User` **has a** `Portfolio`                        | composition |
| `User` **has many** `Order`                         | aggregation |
| `Broker` **has a** `TradeEngine`                    | composition |
| `Broker` **has a** `Market`                         | composition |
| `Market` **has many** `Stock`                       | aggregation |
| `TradeEngine` **uses** `Market`, **updates** `User` | association |
| `Portfolio` **uses** `Market` for P&L               | association |
| `DataStore` **persists** `User`                     | association |


ğŸ”„ Behavioural View (Lifecycle)

| Step | Actor           | Action                                         |
| ---- | --------------- | ---------------------------------------------- |
| 1ï¸âƒ£  | **User**        | Calls `Broker.place_order()`                   |
| 2ï¸âƒ£  | **Broker**      | Creates `Order`, validates, forwards           |
| 3ï¸âƒ£  | **TradeEngine** | Executes, updates `User.balance` & `Portfolio` |
| 4ï¸âƒ£  | **Portfolio**   | Recalculates holdings                          |
| 5ï¸âƒ£  | **Market**      | Provides price data                            |
| 6ï¸âƒ£  | **DataStore**   | Saves new state to file                        |


ğŸ§  Core OOP Concepts Illustrated

| Concept                       | Where It Appears                                                     |
| ----------------------------- | -------------------------------------------------------------------- |
| **Encapsulation**             | Each class manages its own data (`Portfolio`, `User`, `TradeEngine`) |
| **Abstraction**               | Market hides price update logic; Broker hides execution details      |
| **Composition**               | User â†’ Portfolio; Broker â†’ TradeEngine                               |
| **Inheritance (future use)**  | Could extend `Order` â†’ `LimitOrder`, `MarketOrder`                   |
| **Polymorphism (future use)** | Different order types could override `execute()`                     |


                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚        Market            â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                         â”‚ - stocks: dict[str,Stock]â”‚
                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                         â”‚ + start_market()         â”‚
                         â”‚ + get_price(symbol)      â”‚
                         â”‚ + list_stocks()          â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ 1..*
                                      â”‚
                                      â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚        Stock          â”‚
                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                           â”‚ - symbol: str         â”‚
                           â”‚ - name: str           â”‚
                           â”‚ - price: float        â”‚
                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
                           â”‚ + update_price()      â”‚
                           â”‚ + __str__()           â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         uses          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Broker         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚         Market            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - market: Market      â”‚
â”‚ - trade_engine: TradeEngine â”‚
â”‚ - order_book: list[Order]   â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ + place_order()      â”‚
â”‚ + _validate_order()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ has a
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      TradeEngine         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ - market: Market         â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ + execute_order(order)   â”‚
â”‚ + _update_portfolio_buy()â”‚
â”‚ + _update_portfolio_sell()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ updates
           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚          User            â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚ - username: str          â”‚
   â”‚ - balance: float         â”‚
   â”‚ - portfolio: Portfolio   â”‚
   â”‚ - order_history: list[Order] â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚ + add_order(order)       â”‚
   â”‚ + show_portfolio(market) â”‚
   â”‚ + __str__()              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ has a
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚       Portfolio         â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚ - holdings: dict        â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚ + add_buy()             â”‚
     â”‚ + add_sell()            â”‚
     â”‚ + compute_pnl()         â”‚
     â”‚ + summary()             â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Order            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ - id: str                 â”‚
â”‚ - user: User              â”‚
â”‚ - symbol: str             â”‚
â”‚ - qty: int                â”‚
â”‚ - order_type: str         â”‚
â”‚ - price: float            â”‚
â”‚ - status: str             â”‚
â”‚ - timestamp: datetime     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ + __str__()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       DataStore           â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ - file: str               â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ + save_user(user)         â”‚
â”‚ + load_user(username)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Questions:

user.py